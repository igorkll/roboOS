if component.proxy(component.list"gpu"()or"")then if component.proxy(component.list"gpu"()or"").bind(component.list"screen"()or"",true)then component.proxy(component.list"gpu"()or"").setResolution(50,16)end end;function getDataPart(b)return split(component.proxy(component.list"eeprom"()).getData(),"\n")[b]or""end;function setDataPart(b,c)if getDataPart(b)==c then return end;if c:find"\n"then error"\\n char"end;local d=split(component.proxy(component.list"eeprom"()).getData(),"\n")for e=b,1,-1 do if not d[e]then d[e]=""end end;d[b]=c;component.proxy(component.list"eeprom"()).setData(table.concat(d,"\n"))end;function split(f,g)local d,h,e={},1,1;while 1 do if e>#f then break end;local i=f:sub(e,#g+e-1)if not d[h]then d[h]=""end;if i==g then h=h+1;e=e+#g else d[h]=d[h]..f:sub(e,e)e=e+1 end end;if f:sub(#f-(#g-1),#f)==g then table.insert(d,"")end;return d end;function toParts(f,j)local k,l,i={},""for e=1,#f do i=f:sub(e,e)l=l..i;if#l>=j then table.insert(k,l)l=""end end;table.insert(k,l)if#k[#k]==0 then table.remove(k,#k)end;return k end;function getFile(m,n)local n,o,p=assert(m.open(n,"rb")),""while 1 do p=m.read(n,math.huge)if not p then break end;o=o..p end;m.close(n)return o end;function saveFile(m,n,p)local n=assert(m.open(n,"wb"))m.write(n,p)m.close(n)end;function bootToOS(m,n)function computer.getBootAddress()return m.address end;function computer.getBootGpu()return component.proxy(component.list"gpu"()or"")and component.proxy(component.list"gpu"()or"").address end;function computer.getBootScreen()return component.proxy(component.list"gpu"()or"")and component.proxy(component.list"gpu"()or"").getScreen()end;function computer.getBootFile()return n end;function computer.setBootAddress()end;function computer.setBootScreen()end;function computer.setBootFile()end;assert(load(getFile(m,n),"=init"))()computer.shutdown()end;function fs_path(q)if split(q,"/")[#split(q,"/")]==""then split(q,"/")[#split(q,"/")]=a end;return table.concat({table.unpack(split(q,"/"),1,#split(q,"/")-1)},"/")end;function getInternetFile(r)local s,p,t,u=component.proxy(component.list"internet"()).request(r),""if s then while 1 do t,u=s.read(math.huge)if t then p=p..t else s.close()if u then return a,u else return p end end end else return a,"Unvalid Address"end end;local v,w,x,y,z,k,A,o,f,B;if component.proxy(component.list"gpu"()or"")then gui={}w,x=component.proxy(component.list"gpu"()or"").getResolution()y,z,k,A,o,f="","",{},math.floor(w/3*2)function gui.invert()component.proxy(component.list"gpu"()or"").setBackground(component.proxy(component.list"gpu"()or"").setForeground(component.proxy(component.list"gpu"()or"").getBackground()))end;function gui.read(f)o=""local function C()f=f..": "..o.."_"while#f>w do f=f:sub(2,#f)end;component.proxy(component.list"gpu"()or"").set(1,x,f.." ")end;C()local function D()component.proxy(component.list"gpu"()or"").fill(1,x,w,1," ")end;while 1 do v={computer.pullSignal()}if v[1]=="key_down"then if v[4]==28 then D()return o elseif v[3]>=32 and v[3]<=126 then o=o..string.char(v[3])C()elseif v[4]==14 then if#o>0 then o=o:sub(1,#o-1)C()end elseif v[4]==46 then D()break end elseif v[1]=="clipboard"then o=o..v[3]C()if o:byte(#o)==13 then D()return o end end end end;function gui.draw(E,F)component.proxy(component.list"gpu"()or"").fill(1,1,w,x," ")component.proxy(component.list"gpu"()or"").set(1,1,y)component.proxy(component.list"gpu"()or"").fill(1,2,w,1,"─")component.proxy(component.list"gpu"()or"").fill(1,x-1,w,1,"─")component.proxy(component.list"gpu"()or"").fill(A,3,1,x-4,"│")component.proxy(component.list"gpu"()or"").fill(A+1,x/2,w-A,1,"─")local function G(H,I)local J,K,L=split(H or"not found","\n"),{}for e,M in ipairs(J)do L=toParts(M,w-A)for e,M in ipairs(L)do table.insert(K,M)end end;for e,p in ipairs(K)do component.proxy(component.list"gpu"()or"").set(A+1,e+I-1,p)end end;component.proxy(component.list"gpu"()or"").set(A+1,3,"menu doc:")G(z[0],4)gpu.set(A+1,x/2+1,"menu point doc:")component.proxy(component.list"gpu"()or"")(z[E],x/2+2)for e,p in ipairs(k)do local I=e+2;I=I-F;if I>=3 and I<=x-2 then if e==E then gui.invert()end;component.proxy(component.list"gpu"()or"").set(1,I,p)if e==E then gui.invert()end end end end;function gui.menu(E,F)gui.draw(E,F)while 1 do v={computer.pullSignal()}if v[1]=="key_down"then if v[4]==28 then return E,F elseif v[4]==200 then if E>1 then E=E-1;if E+2-F<3 then F=F-1 end;gui.draw(E,F)end elseif v[4]==208 then if E<#k then E=E+1;if E+2-F>x-2 then F=F+1 end;gui.draw(E,F)end end end end end;function gui.setData(N,O,P)y,z=N,type(O)=="string"and{[0]=O}or O;k={}for e,M in ipairs(P)do local f=M:sub(1,A-1)while#f<A-1 do f=f.." "end;table.insert(k,f)end end;function gui.setText(f,Q,I)component.proxy(component.list"gpu"()or"").set((Q or 0)+math.floor(w/2-(unicode.len(f)-1)/2+0.5),I or math.floor(x/2+0.5),f)end;function gui.warn(f)component.proxy(component.list"gpu"()or"").fill(8,3,w-15,x-4,"▒")gui.setText("▒▒▒▒▒▒█▒▒▒▒▒▒",a,4)gui.setText("▒▒▒▒▒███▒▒▒▒▒",a,5)gui.setText("▒▒▒▒██ ██▒▒▒▒",a,6)gui.setText("▒▒▒███████▒▒▒",a,7)gui.setText("▒▒████ ████▒▒",a,8)gui.setText("▒█████ █████▒",a,9)gui.setText("█████████████",a,10)gui.setText(f,a,12)gui.setText("Press Enter To Continue",a,13)computer.beep(100,0.2)while 1 do v={computer.pullSignal()}if v[1]=="key_down"and v[4]==28 then break end end end;function gui.status(f)component.proxy(component.list"gpu"()or"").fill(8,3,w-15,x-4,"▒")gui.setText(f,a,x/2)computer.beep(1000,0.1)end;function gui.yesno(f)gui.invert()component.proxy(component.list"gpu"()or"").fill(w/2-10,x/2-1,20,5,"▒")gui.setText(f,a,x/2)computer.beep(500,0.01)computer.beep(2000,0.01)local R=a;while 1 do if R then gui.invert()end;gui.setText("yes",-5,x/2+2)if R then gui.invert()end;if not R then gui.invert()end;gui.setText("no",5,x/2+2)if not R then gui.invert()end;v={computer.pullSignal()}if v[1]=="key_down"then if v[4]==203 then R=1 elseif v[4]==205 then R=a elseif v[4]==28 then gui.invert()return R end end end end end;if gui then local S=getDataPart(1)=="1"if S then gui.invert()end;function B(T)if T~=S then gui.invert()setDataPart(1,T and"1"or"")S=T end end end;local function U()local E,F,k,H=1,0,{"white","black","exit"},{[0]="theme selector","white theme","black theme"}while 1 do gui.setData("theme selector",H,k)E,F=gui.menu(E,F)if E==1 then B(true)elseif E==2 then B(false)elseif E==3 then break end end end;local function V()local E,F=1,0;while 1 do local k,W,z={"add new user","exit"},{},{[0]="user management(useradd/userremove/userlist)","press enter to add new user"}for X,Y in ipairs{computer.users()}do table.insert(k,1,Y)table.insert(W,1,function()if gui.yesno"remove user?"then for e,M in ipairs(k)do if M==Y then table.remove(k,e)table.remove(W,e)computer.removeUser(Y)break end end end end)table.insert(z,1,"press enter to remove this user")end;gui.setData("usermenager",z,k)E,F=gui.menu(E,F)if E==#k then break elseif E==#k-1 then local Y=gui.read"nikname"if Y then local Z,_=computer.addUser(Y)if not Z then gui.warn(_)end end else W[E]()end end end;local function a0()local E,F,k,H=1,0,{"priority external","priority internal","only external","only internal","disable","exit"},{}if getDataPart(2)==""then H[0]="autoruns settings".."currect mode:\npriority external"elseif getDataPart(2)=="i"then H[0]="autoruns settings".."currect mode:\npriority internal"elseif getDataPart(2)=="b"then H[0]="autoruns settings".."currect mode:\nonly external"elseif getDataPart(2)=="a"then H[0]="autoruns settings".."currect mode:\nonly internal"elseif getDataPart(2)=="d"then H[0]="autoruns settings".."currect mode:\ndisable"end;while 1 do gui.setData("autorun",H,k)E,F=gui.menu(E,F)if E==1 then setDataPart(2,"")elseif E==2 then setDataPart(2,"i")elseif E==3 then setDataPart(2,"b")elseif E==4 then setDataPart(2,"a")elseif E==5 then setDataPart(2,"d")elseif E==6 then break end;if getDataPart(2)==""then H[0]="autoruns settings".."currect mode:\npriority external"elseif getDataPart(2)=="i"then H[0]="autoruns settings".."currect mode:\npriority internal"elseif getDataPart(2)=="b"then H[0]="autoruns settings".."currect mode:\nonly external"elseif getDataPart(2)=="a"then H[0]="autoruns settings".."currect mode:\nonly internal"elseif getDataPart(2)=="d"then H[0]="autoruns settings".."currect mode:\ndisable"end end end;local function a1()while 1 do local E,F,k,z,a2=1,0,{"exit"},{},{[0]="boot to:\nopenOS\nplan9k\nother..."}for a3 in component.list"filesystem"do a2=component.proxy(a3)local function a4(n)table.insert(k,1,(a2.getLabel()or"noLabel")..":"..a3:sub(1,6)..":"..n)table.insert(osList,1,function()bootToOS(a2,n)end)table.insert(z,1,"label: "..(a2.getLabel()or"noLabel").."\naddress: "..a3:sub(1,6).."\nfile: "..n)end;if a2.exists"/init.lua"then a4"/init.lua"end;for X,n in ipairs(a2.list"/boot/kernel"or{})do a4("/boot/kernel/"..n)end end;while 1 do gui.setData("boot to external os",z,k)E,F=gui.menu(E,F)if E==#k then return else osList[E]()end end end end;local function a5()local E,F,k,H=1,0,{"autorun","usermenager","theme","exit"},{"set autorun mode and autorun programm","user management(useradd/userremove/userlist)","theme selector"}while 1 do gui.setData("settings",H,k)E,F=gui.menu(E,F)if E==1 then a0()elseif E==2 then V()elseif E==3 then U()elseif E==4 then break end end end;local function a6(m,n)local Z,p,a7,_=pcall(getFile,m,n)if not Z or not p then if gui then gui.warn("err to get programm")end;return a,"err to get programm"end;a7,_=load(p,"=programm")if not a7 then if gui then gui.warn("err to load programm: ".._)end;return a,_ end;Z,_=pcall(a7,{file=n,fs=m})if not Z then if gui then gui.warn("err to run programm: "..(_ or"unknown"))end;return a,_ or"unknown"end;return 1 end;local function a8()local a9,k,aa,E,F,r,p,_,a2,ab,q=component.proxy(component.list"internet"()or""),{},{},1,0;if not a9 then gui.warn"internet card is not found"return end;r=gui.read("url")if r then gui.status"downloading"p,_=getInternetFile(r)if not p then gui.warn(_ or"unknown")return end;for a3 in component.list"filesystem"do a2=component.proxy(a3)if not a2.isReadOnly()then table.insert(aa,function()ab=gui.read"name to save"if ab then if ab:find"%/"or ab:find"%\\"then gui.status"unsupported char /"else q="/roboOS/programs/"..ab;if a2.exists(q)then gui.warn("this name used")return end;a2.makeDirectory(q)saveFile(a2,q.."/main.lua",p)return 1 end end end)table.insert(k,(a2.getLabel()or"noLabel")..":"..a3:sub(1,6))end end;table.insert(k,"exit")gui.setData("select drive to save",{},k)while 1 do E,F=gui.menu(E,F)if not aa[E]then break end;if aa[E]()then return 1 end end end end;local ac,ad,ae,af,ag,ah,ai,v={},{},{}if getDataPart(2)~="d"then do ah=computer.getDeviceInfo()for a3 in component.list"filesystem"do if a3~=computer.tmpAddress()and(component.slot(a3)<0 or ah[a3].clock=="20/20/20")then table.insert(ad,a3)else table.insert(ac,a3)end end end;if getDataPart(2)==""then table.insert(ae,ad)table.insert(ae,ac)elseif getDataPart(2)=="i"then table.insert(ae,ac)table.insert(ae,ad)elseif getDataPart(2)=="a"then table.insert(ae,ac)elseif getDataPart(2)=="b"then table.insert(ae,ad)end;for X,aj in ipairs(ae)do for X,a3 in ipairs(aj)do local a2,p=component.proxy(a3)if a2.exists"/roboOS/autorun.cfg"then p=getFile(a2,"/roboOS/autorun.cfg")if a2.exists(p)then af=a2;ag=p;goto ak end end end end::ak::end;if af then if gui then gui.status"press alt to skip autorun"ai=computer.uptime()repeat v={computer.pullSignal(0.1)}if v[1]=="key_down"and v[4]==56 then goto al end until computer.uptime()-ai>1 end;a6(af,ag)::al::end;if gui then while 1 do local E,F,k,H,aa=1,0,{"refresh","shutdown","reboot","settings","boot to external os","download programm"},{[0]="navigation ↑↓\nok - enter",[5]="boot to:\nopenOS\nplan9k\nother...",[6]="download programm from internet used internet-card"},{}for a3 in component.list"filesystem"do local a2,am,an,ao,ap=component.proxy(a3),"/roboOS/programs/"for X,n in ipairs(a2.list(am)or{})do an=am..n;if a2.isDirectory(an)and a2.exists(an.."main.lua")then ao=n:sub(1,#n-1)table.insert(k,ao)ap=#k;H[ap]="address: "..a3:sub(1,6).."\nlabel: "..(a2.getLabel()or"noLabel").."\n"if a2.exists(an.."doc.txt")then H[ap]=H[ap]..getFile(a2,an.."doc.txt")end;aa[ap]=function()local function aq(ar)local k,as,a2,E,F,ab,at,au={},{}for a3 in component.list"filesystem"do a2=component.proxy(a3)if not a2.isReadOnly()then table.insert(k,(a2.getLabel()or"noLabel")..":"..a3:sub(1,6))table.insert(as,a3)end end;table.insert(k,"exit")gui.setData("select target to "..(ar and"move "or"copy ")..ao,{},k)E,F=gui.menu(1,0)if not as[E]then return 1 end;ab=ao;if gui.yesno"use new name?"then gui.draw(E,F)at=gui.read"new name"if not at then gui.warn"using new name canceled"gui.draw(E,F)elseif ab:find"%/"or ab:find"%\\"then gui.warn"unsupported char /"return 1 else ab=at end end;if not gui.yesno(ar and"move?"or"copy?")then return 1 end;au=component.proxy(as[E])local function av(q,aw)for X,n in ipairs(a2.list(q))do local ax,ay=q..n,aw.."/"..n;if a2.isDirectory(ax)then av(ax,ay)else au.makeDirectory(fs_path(ay))saveFile(au,ay,getFile(a2,ax))end end end;if au.exists("/roboOS/programs/"..ab)then gui.warn"this name used"return 1 end;av(an,"/roboOS/programs/"..ab)end;local E,F,az,aA,aB=1,0;while 1 do gui.setData("programm "..ao,{[0]=H[ap]},{"open","set to autorun","move","copy","remove","rename","back"})E,F=gui.menu(E,F)aA=an;aB=a2.exists"/roboOS/autorun.cfg"and getFile(a2,"/roboOS/autorun.cfg")==aA.."main.lua"if E==1 then if not a6(a2,an.."main.lua")then return 1 end elseif E==2 then if gui.yesno("set autorun?")then saveFile(a2,"/roboOS/autorun.cfg",an.."main.lua")end elseif E==3 then if not aq(1)then a2.remove(an)if aB then a2.remove"/roboOS/autorun.cfg"end;return 1 end elseif E==4 then if not aq()then az=1 end elseif E==5 then if gui.yesno"remove?"then a2.remove(an)if aB then a2.remove"/roboOS/autorun.cfg"end;return 1 end elseif E==6 then local p=gui.read"new name"if p then if p:find"%/"or p:find"%\\"then gui.warn"unsupported char /"else an=fs_path(aA).."/"..p;a2.rename(aA,an)if aB then saveFile(a2,"/roboOS/autorun.cfg",an.."/main.lua")end;return 1 end end else return az end end end end end end;while 1 do gui.setData("roboOS",H,k)E,F=gui.menu(E,F)if E==1 then break elseif E==2 then computer.shutdown()elseif E==3 then computer.shutdown(1)elseif E==4 then a5()elseif E==5 then a1()elseif E==6 then if a8()then break end else if aa[E]()then break end end end end end