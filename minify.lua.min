local b=component.proxy(component.list"gpu"()or"")if b then if b.bind(component.list"screen"()or"",true)then b.setResolution(50,16)else b=a end end;local c=component.proxy(component.list"eeprom"())function getDataPart(d)return split(c.getData(),"\n")[d]or""end;function setDataPart(d,e)if getDataPart(d)==e then return end;if e:find"\n"then error"\\n char"end;local f=split(c.getData(),"\n")for g=d,1,-1 do if not f[g]then f[g]=""end end;f[d]=e;c.setData(table.concat(f,"\n"))end;function split(h,i)local f,j,g={},1,1;while 1 do if g>#h then break end;local k=h:sub(g,#i+g-1)if not f[j]then f[j]=""end;if k==i then j=j+1;g=g+#i else f[j]=f[j]..h:sub(g,g)g=g+1 end end;if h:sub(#h-(#i-1),#h)==i then table.insert(f,"")end;return f end;function toParts(h,l)local m={}local n=""for g=1,#h do local k=h:sub(g,g)n=n..k;if#n>=l then table.insert(m,n)n=""end end;table.insert(m,n)if#m[#m]==0 then table.remove(m,#m)end;return m end;function getFile(o,p)local p=assert(o.open(p,"rb"))local q=""while 1 do local r=o.read(p,math.huge)if not r then break end;q=q..r end;o.close(p)return q end;function saveFile(o,p,r)local p=assert(o.open(p,"wb"))o.write(p,r)o.close(p)end;function bootToOS(o,p)function computer.getBootAddress()return o.address end;function computer.getBootGpu()return b and b.address end;function computer.getBootScreen()return b and b.getScreen()end;function computer.getBootFile()return p end;function computer.setBootAddress()end;function computer.setBootScreen()end;function computer.setBootFile()end;assert(load(getFile(o,p),"=init"))()computer.shutdown()end;function fs_path(s)local t=split(s,"/")if t[#t]==""then t[#t]=a end;return table.concat({table.unpack(t,1,#t-1)},"/")end;function getInternetFile(u)local v,r,w,x=component.proxy(component.list"internet"()).request(u),""if v then while 1 do w,x=v.read(math.huge)if w then r=r..w else v.close()if x then return a,x else return r end end end else return a,"Unvalid Address"end end;if b then gui={}local y,z=b.getResolution()local A,B,m,C="","",{},math.floor(y/3*2)function gui.invert()b.setBackground(b.setForeground(b.getBackground()))end;function gui.read(h)local q=""local function D()local h=h..": "..q.."_"while#h>y do h=h:sub(2,#h)end;b.set(1,z,h.." ")end;D()local function E()b.fill(1,z,y,1," ")end;while 1 do local F={computer.pullSignal()}if F[1]=="key_down"then if F[4]==28 then E()return q elseif F[3]>=32 and F[3]<=126 then q=q..string.char(F[3])D()elseif F[4]==14 then if#q>0 then q=q:sub(1,#q-1)D()end elseif F[4]==46 then E()break end elseif F[1]=="clipboard"then q=q..F[3]D()if q:byte(#q)==13 then E()return q end end end end;function gui.draw(G,H)b.fill(1,1,y,z," ")b.set(1,1,A)b.fill(1,2,y,1,"─")b.fill(1,z-1,y,1,"─")b.fill(C,3,1,z-4,"│")b.fill(C+1,z/2,y-C,1,"─")local function I(J,K)local L=split(J or"not found","\n")local M={}for g,N in ipairs(L)do local O=toParts(N,y-C)for g,N in ipairs(O)do table.insert(M,N)end end;for g,r in ipairs(M)do b.set(C+1,g+K-1,r)end end;b.set(C+1,3,"menu doc:")I(B[0],4)b.set(C+1,z/2+1,"menu point doc:")I(B[G],z/2+2)for g,r in ipairs(m)do local K=g+2;K=K-H;if K>=3 and K<=z-2 then if g==G then gui.invert()end;b.set(1,K,r)if g==G then gui.invert()end end end end;function gui.menu(G,H)gui.draw(G,H)while 1 do local F={computer.pullSignal()}if F[1]=="key_down"then if F[4]==28 then return G,H elseif F[4]==200 then if G>1 then G=G-1;if G+2-H<3 then H=H-1 end;gui.draw(G,H)end elseif F[4]==208 then if G<#m then G=G+1;if G+2-H>z-2 then H=H+1 end;gui.draw(G,H)end end end end end;function gui.setData(P,Q,R)A,B=P,type(Q)=="string"and{[0]=Q}or Q;m={}for g,N in ipairs(R)do local h=N:sub(1,C-1)while#h<C-1 do h=h.." "end;table.insert(m,h)end end;function gui.setText(h,S,K)b.set((S or 0)+math.floor(y/2-(unicode.len(h)-1)/2+0.5),K or math.floor(z/2+0.5),h)end;function gui.warn(h)b.fill(8,3,y-15,z-4,"▒")gui.setText("▒▒▒▒▒▒█▒▒▒▒▒▒",a,4)gui.setText("▒▒▒▒▒███▒▒▒▒▒",a,5)gui.setText("▒▒▒▒██ ██▒▒▒▒",a,6)gui.setText("▒▒▒███████▒▒▒",a,7)gui.setText("▒▒████ ████▒▒",a,8)gui.setText("▒█████ █████▒",a,9)gui.setText("█████████████",a,10)gui.setText(h,a,12)gui.setText("Press Enter To Continue",a,13)computer.beep(100,0.2)while 1 do local F={computer.pullSignal()}if F[1]=="key_down"and F[4]==28 then break end end end;function gui.status(h)b.fill(8,3,y-15,z-4,"▒")gui.setText(h,a,z/2)computer.beep(1000,0.1)end;function gui.yesno(h)gui.invert()b.fill(y/2-10,z/2-1,20,5,"▒")gui.setText(h,a,z/2)computer.beep(500,0.01)computer.beep(2000,0.01)local T=a;while 1 do if T then gui.invert()end;gui.setText("yes",-5,z/2+2)if T then gui.invert()end;if not T then gui.invert()end;gui.setText("no",5,z/2+2)if not T then gui.invert()end;local F={computer.pullSignal()}if F[1]=="key_down"then if F[4]==203 then T=1 elseif F[4]==205 then T=a elseif F[4]==28 then gui.invert()return T end end end end end;local U;if gui then local V=getDataPart(1)=="1"if V then gui.invert()end;function U(W)if W~=V then gui.invert()setDataPart(1,W and"1"or"")V=W end end end;local function X()local G,H=1,0;local m={"white","black","exit"}local J={[0]="theme selector","white theme","black theme"}while 1 do gui.setData("theme selector",J,m)G,H=gui.menu(G,H)if G==1 then U(true)elseif G==2 then U(false)elseif G==3 then break end end end;local function Y()local G,H=1,0;while 1 do local m={"add new user","exit"}local Z={}local B={[0]="user management(useradd/userremove/userlist)","press enter to add new user"}for _,a0 in ipairs{computer.users()}do table.insert(m,1,a0)table.insert(Z,1,function()if gui.yesno"remove user?"then for g,N in ipairs(m)do if N==a0 then table.remove(m,g)table.remove(Z,g)computer.removeUser(a0)break end end end end)table.insert(B,1,"press enter to remove this user")end;gui.setData("usermenager",B,m)G,H=gui.menu(G,H)if G==#m then break elseif G==#m-1 then local a0=gui.read"nikname"if a0 then local a1,a2=computer.addUser(a0)if not a1 then gui.warn(a2)end end else Z[G]()end end end;local function a3()local G,H=1,0;local m={"priority external","priority internal","only external","only internal","disable","exit"}local J={}local function a4()if getDataPart(2)==""then J[0]="autoruns settings".."currect mode:\npriority external"elseif getDataPart(2)=="i"then J[0]="autoruns settings".."currect mode:\npriority internal"elseif getDataPart(2)=="b"then J[0]="autoruns settings".."currect mode:\nonly external"elseif getDataPart(2)=="a"then J[0]="autoruns settings".."currect mode:\nonly internal"elseif getDataPart(2)=="d"then J[0]="autoruns settings".."currect mode:\ndisable"end end;a4()while 1 do gui.setData("autorun",J,m)G,H=gui.menu(G,H)if G==1 then setDataPart(2,"")elseif G==2 then setDataPart(2,"i")elseif G==3 then setDataPart(2,"b")elseif G==4 then setDataPart(2,"a")elseif G==5 then setDataPart(2,"d")elseif G==6 then break end;a4()end end;local function a5()while 1 do local G,H=1,0;local m={"exit"}local a6={}local B={[0]="boot to:\nopenOS\nplan9k\nother..."}for a7 in component.list"filesystem"do local a8=component.proxy(a7)local function a9(p)table.insert(m,1,(a8.getLabel()or"noLabel")..":"..a7:sub(1,6)..":"..p)table.insert(a6,1,function()bootToOS(a8,p)end)table.insert(B,1,"label: "..(a8.getLabel()or"noLabel").."\naddress: "..a7:sub(1,6).."\nfile: "..p)end;if a8.exists"/init.lua"then a9"/init.lua"end;for _,p in ipairs(a8.list"/boot/kernel"or{})do a9("/boot/kernel/"..p)end end;while 1 do gui.setData("boot to external os",B,m)G,H=gui.menu(G,H)if G==#m then return else a6[G]()end end end end;local function aa()local G,H=1,0;local m={"autorun","usermenager","theme","exit"}local J={"set autorun mode and autorun programm","user management(useradd/userremove/userlist)","theme selector"}while 1 do gui.setData("settings",J,m)G,H=gui.menu(G,H)if G==1 then a3()elseif G==2 then Y()elseif G==3 then X()elseif G==4 then break end end end;local function ab(o,p)local a1,r=pcall(getFile,o,p)if not a1 or not r then local ac="err to get programm"if gui then gui.warn(ac)end;return a,ac end;local ad,a2=load(r,"=programm")if not ad then if gui then gui.warn("err to load programm: "..a2)end;return a,a2 end;local a1,a2=pcall(ad,{file=p,fs=o})if not a1 then if gui then gui.warn("err to run programm: "..(a2 or"unknown"))end;return a,a2 or"unknown"end;return 1 end;local function ae()local af=component.proxy(component.list"internet"()or"")if not af then gui.warn"internet card is not found"return end;local u=gui.read("url")if u then gui.status"downloading"local r,a2=getInternetFile(u)if not r then gui.warn(a2 or"unknown")return end;local m={}local ag={}for a7 in component.list"filesystem"do local a8=component.proxy(a7)if not a8.isReadOnly()then table.insert(ag,function()local ah=gui.read"name to save"if ah then if ah:find"%/"or ah:find"%\\"then gui.status"unsupported char /"else local s="/roboOS/programs/"..ah;if a8.exists(s)then gui.warn("this name used")return end;a8.makeDirectory(s)saveFile(a8,s.."/main.lua",r)return 1 end end end)table.insert(m,(a8.getLabel()or"noLabel")..":"..a7:sub(1,6))end end;table.insert(m,"exit")gui.setData("select drive to save",{},m)local G,H=1,0;while 1 do G,H=gui.menu(G,H)if not ag[G]then break end;if ag[G]()then return 1 end end end end;local ai,aj;if getDataPart(2)~="d"then local ak,al={},{}do local am=computer.getDeviceInfo()for a7 in component.list"filesystem"do if a7~=computer.tmpAddress()and(component.slot(a7)<0 or am[a7].clock=="20/20/20")then table.insert(al,a7)else table.insert(ak,a7)end end end;local an={}if getDataPart(2)==""then table.insert(an,al)table.insert(an,ak)elseif getDataPart(2)=="i"then table.insert(an,ak)table.insert(an,al)elseif getDataPart(2)=="a"then table.insert(an,ak)elseif getDataPart(2)=="b"then table.insert(an,al)end;for _,ao in ipairs(an)do for _,a7 in ipairs(ao)do local a8=component.proxy(a7)if a8.exists"/roboOS/autorun.cfg"then local r=getFile(a8,"/roboOS/autorun.cfg")if a8.exists(r)then ai=a8;aj=r;goto ap end end end end::ap::end;if ai then if gui then gui.status"press alt to skip autorun"local aq=computer.uptime()repeat local F={computer.pullSignal(0.1)}if F[1]=="key_down"and F[4]==56 then goto ar end until computer.uptime()-aq>1 end;ab(ai,aj)::ar::end;if gui then while 1 do local G,H=1,0;local m={"refresh","shutdown","reboot","settings","boot to external os","download programm"}local J={[0]="navigation ↑↓\nok - enter",[5]="boot to:\nopenOS\nplan9k\nother...",[6]="download programm from internet used internet-card"}local ag={}for a7 in component.list"filesystem"do local a8=component.proxy(a7)local as="/roboOS/programs/"for _,p in ipairs(a8.list(as)or{})do local at=as..p;if a8.isDirectory(at)and a8.exists(at.."main.lua")then local au=p:sub(1,#p-1)table.insert(m,au)local av=#m;J[av]="address: "..a7:sub(1,6).."\nlabel: "..(a8.getLabel()or"noLabel").."\n"if a8.exists(at.."doc.txt")then J[av]=J[av]..getFile(a8,at.."doc.txt")end;ag[av]=function()local function aw(ax)local m={}local ay={}for a7 in component.list"filesystem"do local a8=component.proxy(a7)if not a8.isReadOnly()then table.insert(m,(a8.getLabel()or"noLabel")..":"..a7:sub(1,6))table.insert(ay,a7)end end;table.insert(m,"exit")gui.setData("select target to "..(ax and"move "or"copy ")..au,{},m)local G,H=gui.menu(1,0)if not ay[G]then return 1 end;local ah=au;if gui.yesno"use new name?"then gui.draw(G,H)local az=gui.read"new name"if not az then gui.warn"using new name canceled"gui.draw(G,H)elseif ah:find"%/"or ah:find"%\\"then gui.warn"unsupported char /"return 1 else ah=az end end;if not gui.yesno(ax and"move?"or"copy?")then return 1 end;local aA=component.proxy(ay[G])local function aB(s,aC)for _,p in ipairs(a8.list(s))do local aD=s..p;local aE=aC.."/"..p;if a8.isDirectory(aD)then aB(aD,aE)else aA.makeDirectory(fs_path(aE))saveFile(aA,aE,getFile(a8,aD))end end end;if aA.exists("/roboOS/programs/"..ah)then gui.warn"this name used"return 1 end;aB(at,"/roboOS/programs/"..ah)end;local G,H,aF=1,0;while 1 do gui.setData("programm "..au,{[0]=J[av]},{"open","set to autorun","move","copy","remove","rename","back"})G,H=gui.menu(G,H)local aG=at;local aH=a8.exists"/roboOS/autorun.cfg"and getFile(a8,"/roboOS/autorun.cfg")==aG.."main.lua"if G==1 then if not ab(a8,at.."main.lua")then return 1 end elseif G==2 then if gui.yesno("set autorun?")then saveFile(a8,"/roboOS/autorun.cfg",at.."main.lua")end elseif G==3 then if not aw(1)then a8.remove(at)if aH then a8.remove"/roboOS/autorun.cfg"end;return 1 end elseif G==4 then if not aw()then aF=1 end elseif G==5 then if gui.yesno"remove?"then a8.remove(at)if aH then a8.remove"/roboOS/autorun.cfg"end;return 1 end elseif G==6 then local r=gui.read"new name"if r then if r:find"%/"or r:find"%\\"then gui.warn"unsupported char /"else at=fs_path(aG).."/"..r;a8.rename(aG,at)if aH then saveFile(a8,"/roboOS/autorun.cfg",at.."/main.lua")end;return 1 end end else return aF end end end end end end;while 1 do gui.setData("roboOS",J,m)G,H=gui.menu(G,H)if G==1 then break elseif G==2 then computer.shutdown()elseif G==3 then computer.shutdown(1)elseif G==4 then aa()elseif G==5 then a5()elseif G==6 then if ae()then break end else if ag[G]()then break end end end end end